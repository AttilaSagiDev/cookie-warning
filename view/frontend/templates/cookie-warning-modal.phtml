<?php
/**
 * Copyright (c) 2024 Attila Sagi
 * @license http://www.opensource.org/licenses/mit-license.html  MIT License
 */

/**
 * @var $block \Magento\Framework\View\Element\Template
 * @var $escaper Magento\Framework\Escaper;
 * @var $viewModel \Space\CookieWarning\ViewModel\View\CookieWarning
 * @var $secureRenderer \Magento\Framework\View\Helper\SecureHtmlRender
 */

$viewModel = $block->getData('view_model');
?>

<style>
    .cookie-warning {
        position: fixed;
        z-index: 10;
    }

    .cookie-warning .content {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        padding: 1.5rem 2rem;
    }

    .cookie-warning.top {
        top: 0;
        left: 0;
        right: 0;
    }

    .cookie-warning.bottom {
        bottom: 0;
        left: 0;
        right: 0;
    }

    .cookie-warning .content h3 {
        margin-top: 0;
    }

    .cookie-warning .content .actions .decline {
        margin-left: 0.5rem;
    }

</style>

<?php if ($viewModel->isEnabled()): ?>
    <div role="alertdialog"
         tabindex="-1"
         class="cookie-warning <?= $escaper->escapeHtml($viewModel->getPosition()) ?>"
         id="cookie-warning-block">
        <div role="document" class="content" tabindex="0"
             style="background-color: <?= $escaper->escapeHtml($viewModel->getBackgroundColor()) ?>"><!-- //NOSONAR -->
            <div class="message-content">
                <h3 style="color: <?= $escaper->escapeHtml($viewModel->getTextColor()) ?>">
                    <?= $escaper->escapeHtml($viewModel->getTitle()) ?>
                </h3>
                <p class="message" style="color: <?= $escaper->escapeHtml($viewModel->getTextColor()) ?>">
                    <span><?= $escaper->escapeHtml($viewModel->getCookieMessage(), ['strong']) ?></span>
                </p>
                <p class="link">
                    <a href="<?= $escaper->escapeUrl($viewModel->getLinkUrl()) ?>"
                       title="<?= $escaper->escapeHtml($viewModel->getLinkText()) ?>">
                        <span><?= $escaper->escapeHtml($viewModel->getLinkText()) ?></span>
                    </a>
                </p>
            </div>
            <div class="actions">
                <button id="btn-cookie-warning-accept"
                        class="action allow primary"
                        style="background-color: <?= $escaper->escapeHtml($viewModel->getAcceptButtonColor()) ?>;
                            border-color: <?= $escaper->escapeHtml($viewModel->getAcceptButtonColor()) ?>">
                    <span style="color: <?= $escaper->escapeHtml($viewModel->getAcceptButtonTextColor()) ?>">
                        <?= $escaper->escapeHtml($viewModel->getAcceptButtonText()) ?>
                    </span>
                </button>
                <button id="btn-cookie-warning-decline"
                        class="action decline secondary"
                        style="background-color: <?= $escaper->escapeHtml($viewModel->getDeclineButtonColor()) ?>;
                            border-color: <?= $escaper->escapeHtml($viewModel->getDeclineButtonColor()) ?>">
                    <span style="color: <?= $escaper->escapeHtml($viewModel->getDeclineButtonTextColor()) ?>">
                        <?= $escaper->escapeHtml($viewModel->getDeclineButtonText()) ?>
                    </span>
                </button>
            </div>
        </div>
    </div>
    <?= /* @noEscape */$secureRenderer->renderStyleAsTag("display: none;", 'div#cookie-warning-block') ?>
    <script type="text/x-magento-init">
        {
            "#cookie-warning-block": {
                "cookieWarning": {
                    "cookieName": "<?= $escaper->escapeHtml($viewModel->getCookieName()) ?>",
                    "cookieLifetimeSeconds": "10",
                    "acceptButtonSelector": "#btn-cookie-warning-accept",
                    "declineButtonSelector": "#btn-cookie-warning-decline"
                }
            }
        }
    </script>
<?php endif; ?>
